# ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ (Prometheus + Loki + Grafana) ê°€ì´ë“œ

## ğŸ“Š ì‹œìŠ¤í…œ ê°œìš”

Groom Shopping ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì€ **Prometheus** (ë©”íŠ¸ë¦­), **Loki** (ë¡œê·¸), **Grafana** (ì‹œê°í™”)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.
ë‹¤ì–‘í•œ Exporterë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜, ë°ì´í„°ë² ì´ìŠ¤, ìºì‹œ, ì„œë²„ ë¦¬ì†ŒìŠ¤ ë“±ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³ ,
ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ë¥¼ Lokiì— ìˆ˜ì§‘í•˜ì—¬ í†µí•© ë¶„ì„í•©ë‹ˆë‹¤.

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ë°ì´í„° ìˆ˜ì§‘ ê³„ì¸µ (Exporters)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Spring Boot App      PostgreSQL        Redis            Nginx           â”‚
â”‚  (Micrometer)         (postgres-exp)    (redis-exp)     (nginx-exp)      â”‚
â”‚      â†“                    â†“                â†“                â†“            â”‚
â”‚  /api/actuator/       http://9187      http://9121     http://9113       â”‚
â”‚   prometheus                                                             â”‚
â”‚                                                                          â”‚
â”‚  Node Exporter        cAdvisor                                           â”‚
â”‚  (ì„œë²„ ë¦¬ì†ŒìŠ¤)         (ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤)                                        â”‚
â”‚      â†“                    â†“                                              â”‚
â”‚  http://9100          http://8090                                        â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“
                         (ìŠ¤í¬ë˜í•‘ pull ë°©ì‹)
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Prometheus (ë©”íŠ¸ë¦­ ìˆ˜ì§‘/ì €ì¥)     Loki (ë¡œê·¸ ìˆ˜ì§‘/ì €ì¥)               â”‚
â”‚  â€¢ 15ì´ˆë§ˆë‹¤ ë©”íŠ¸ë¦­ ìˆ˜ì§‘                   â€¢ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ ìˆ˜ì§‘                 â”‚
â”‚  â€¢ ì‹œê³„ì—´ DB(TSDB)ì— ì €ì¥                â€¢ ë¼ë²¨ ê¸°ë°˜ ì¸ë±ì‹±                     â”‚
â”‚  â€¢ ì €ì¥ ì£¼ê¸°: 15ì¼                      â€¢ ì €ì¥ ì£¼ê¸°: 7ì¼                       â”‚
â”‚  â€¢ ì¿¼ë¦¬ ì—”ì§„: PromQL                    â€¢ ì¿¼ë¦¬ ì—”ì§„: LogQL                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“                              â†“
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Grafana (ì‹œê°í™” ë° ëŒ€ì‹œë³´ë“œ)                             â”‚
â”‚  â€¢ ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ                                                     â”‚
â”‚  â€¢ ë¡œê·¸ ê²€ìƒ‰ ë° ë¶„ì„                                                        â”‚
â”‚  â€¢ ì„±ëŠ¥ ì§€í‘œ ì‹œê°í™”                                                          â”‚
â”‚  â€¢ ì•Œë¦¼ ì„¤ì • (ì„ íƒì‚¬í•­)                                                       â”‚
â”‚  â€¢ í¬íŠ¸: 3030 (localhost:3030)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ë™ì‘ íë¦„ ìƒì„¸

### 1ï¸âƒ£ ë¡œê·¸ ìˆ˜ì§‘ (Promtail)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¡œê·¸ íŒŒì¼ ìƒì„±                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚ logs/application.log íŒŒì¼ ìƒì„±:                                          â”‚
â”‚ 2025-11-13 13:45:23.123 [main] INFO  OrderService - ì£¼ë¬¸ ìƒì„± ì™„ë£Œ     â”‚
â”‚ 2025-11-13 13:45:24.456 [main] DEBUG PaymentService - ê²°ì œ ì²˜ë¦¬ ì¤‘      â”‚
â”‚ 2025-11-13 13:45:25.789 [main] ERROR OrderService - ê²°ì œ ì‹¤íŒ¨           â”‚
â”‚                                                                         â”‚
â”‚ Promtailì´ íŒŒì¼ ë³€ê²½ì„ ê°ì‹œí•˜ë©° ìë™ìœ¼ë¡œ Lokië¡œ ì „ì†¡                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Loki (ë¡œê·¸ ìˆ˜ì§‘ ë° ì €ì¥)                                 â”‚
â”‚  â€¢ Promtailì—ì„œ ë¡œê·¸ ìˆ˜ì‹                                                   â”‚
â”‚  â€¢ ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì¸ë±ì‹±                                                      â”‚
â”‚  â€¢ ì €ì¥ ì£¼ê¸°: 7ì¼                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (Collection)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Exportersê°€ ë©”íŠ¸ë¦­ ë…¸ì¶œ                                            â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚ Spring Boot Application                                                 â”‚
â”‚ â”œâ”€ JVM ë©”íŠ¸ë¦­: GC, ë©”ëª¨ë¦¬, ìŠ¤ë ˆë“œ                                            â”‚
â”‚ â”œâ”€ HTTP ë©”íŠ¸ë¦­: ìš”ì²­ ìˆ˜, ì‘ë‹µ ì‹œê°„, ìƒíƒœ ì½”ë“œ                                   â”‚ 
â”‚ â”œâ”€ ë°ì´í„°ë² ì´ìŠ¤ ë©”íŠ¸ë¦­: ì¿¼ë¦¬ ì‹œê°„, ì—°ê²° í’€                                       â”‚
â”‚ â””â”€ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­: ì£¼ë¬¸ ìˆ˜, ê²°ì œ ì„±ê³µë¥  ë“± (custom)                              â”‚
â”‚    ì—”ë“œí¬ì¸íŠ¸: http://host.docker.internal:8080/api/actuator/prometheus    â”‚
â”‚                                                                         â”‚
â”‚ PostgreSQL (postgres-exporter)                                          â”‚
â”‚ â”œâ”€ ì—°ê²° ìˆ˜                                                                â”‚
â”‚ â”œâ”€ ìºì‹œ íˆíŠ¸ìœ¨                                                             â”‚
â”‚ â”œâ”€ íŠ¸ëœì­ì…˜ ìƒíƒœ                                                            â”‚
â”‚ â””â”€ í…Œì´ë¸” í¬ê¸°                                                              â”‚
â”‚    ì—”ë“œí¬ì¸íŠ¸: http://postgres-exporter:9187/metrics                      â”‚
â”‚                                                                         â”‚
â”‚ Redis (redis-exporter)                                                  â”‚
â”‚ â”œâ”€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰                                                           â”‚
â”‚ â”œâ”€ ëª…ë ¹ ì‹¤í–‰ë¥                                                             â”‚
â”‚ â”œâ”€ í‚¤ ìˆ˜                                                                â”‚
â”‚ â””â”€ ë§Œë£Œëœ í‚¤ ìˆ˜                                                           â”‚
â”‚    ì—”ë“œí¬ì¸íŠ¸: http://redis-exporter:9121/metrics                          â”‚
â”‚                                                                         â”‚
â”‚ Nginx (nginx-exporter)                                                  â”‚
â”‚ â”œâ”€ ìš”ì²­ ì²˜ë¦¬ ìˆ˜                                                            â”‚
â”‚ â”œâ”€ í™œì„± ì—°ê²°                                                              â”‚
â”‚ â””â”€ í—ˆìš© ë° ì²˜ë¦¬ ì‹¤íŒ¨ ì—°ê²°                                                    â”‚
â”‚    ì—”ë“œí¬ì¸íŠ¸: http://nginx-exporter:9113/metrics                          â”‚
â”‚                                                                         â”‚
â”‚ Node Exporter (ì„œë²„ ë¦¬ì†ŒìŠ¤)                                                â”‚
â”‚ â”œâ”€ CPU ì‚¬ìš©ë¥                                                              â”‚
â”‚ â”œâ”€ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥                                                             â”‚
â”‚ â”œâ”€ ë””ìŠ¤í¬ I/O                                                             â”‚
â”‚ â””â”€ ë„¤íŠ¸ì›Œí¬ I/O                                                           â”‚
â”‚    ì—”ë“œí¬ì¸íŠ¸: http://node-exporter:9100/metrics                           â”‚
â”‚                                                                         â”‚
â”‚ cAdvisor (ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤)                                                  â”‚
â”‚ â”œâ”€ ì»¨í…Œì´ë„ˆë³„ CPU/ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥                                                â”‚
â”‚ â”œâ”€ ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ I/O                                                    â”‚
â”‚ â””â”€ ì»¨í…Œì´ë„ˆ ìŠ¤í† ë¦¬ì§€ I/O                                                    â”‚
â”‚    ì—”ë“œí¬ì¸íŠ¸: http://cadvisor:8080/metrics                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3ï¸âƒ£ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (Scraping)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Prometheusê°€ ì£¼ê¸°ì ìœ¼ë¡œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (Pull ë°©ì‹)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚ ìˆ˜ì§‘ ê°„ê²©:                                                                â”‚
â”‚ â€¢ ê¸°ë³¸: 15ì´ˆ (prometheus.ymlì˜ scrape_interval)                           â”‚
â”‚ â€¢ Spring Boot: 10ì´ˆ (ë” ìì£¼ ìˆ˜ì§‘)                                         â”‚
â”‚                                                                         â”‚
â”‚ Prometheus ìˆ˜ì§‘ í”„ë¡œì„¸ìŠ¤:                                                   â”‚
â”‚ 1. ì„¤ì •íŒŒì¼(prometheus.yml)ì—ì„œ íƒ€ê²Ÿ ì½ìŒ                                     â”‚
â”‚ 2. ê° Exporterì˜ ë©”íŠ¸ë¦­ ì—”ë“œí¬ì¸íŠ¸ë¡œ HTTP GET ìš”ì²­                             â”‚
â”‚ 3. í…ìŠ¤íŠ¸ í˜•ì‹ì˜ ë©”íŠ¸ë¦­ ìˆ˜ì‹                                                   â”‚
â”‚ 4. ë©”íŠ¸ë¦­ì„ íŒŒì‹±í•˜ì—¬ ì‹œê³„ì—´ ë°ì´í„°ë¡œ ë³€í™˜                                        â”‚
â”‚ 5. ë¡œì»¬ TSDBì— ì €ì¥                                                        â”‚
â”‚                                                                         â”‚
â”‚ ì˜ˆì‹œ (Spring Boot ë©”íŠ¸ë¦­):                                                 â”‚
â”‚ GET http://host.docker.internal:8080/api/actuator/prometheus            â”‚
â”‚ ì‘ë‹µ:                                                                    â”‚
â”‚ # HELP jvm_memory_used_bytes                                            â”‚
â”‚ # TYPE jvm_memory_used_bytes gauge                                      â”‚
â”‚ jvm_memory_used_bytes{area="heap",...} 1234567890                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4ï¸âƒ£ ì‹œê³„ì—´ ë°ì´í„° ì €ì¥ (Time Series Storage)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ìˆ˜ì§‘ëœ ë©”íŠ¸ë¦­ì„ ì‹œê³„ì—´ ë°ì´í„°ë² ì´ìŠ¤(TSDB)ì— ì €ì¥                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚ Prometheus TSDB íŠ¹ì„±:                                                    â”‚
â”‚ â€¢ ì €ì¥ ìœ„ì¹˜: /prometheus ë””ë ‰í† ë¦¬ (Docker volume)                            â”‚
â”‚ â€¢ ì €ì¥ ì£¼ê¸°(retention): 15ì¼                                               â”‚
â”‚ â€¢ ì¸ë±ì‹±: ë©”íŠ¸ë¦­ ì´ë¦„, ë¼ë²¨ë¡œ ë¹ ë¥¸ ì¿¼ë¦¬ ê°€ëŠ¥                                      â”‚
â”‚ â€¢ ì••ì¶•: ì˜¤ë˜ëœ ë°ì´í„°ëŠ” ìë™ ì••ì¶•                                              â”‚
â”‚                                                                         â”‚
â”‚ ì €ì¥ëœ ë°ì´í„° êµ¬ì¡°:                                                         â”‚
â”‚ {__name__="http_requests_total", instance="spring-boot-app", ...}       â”‚
â”‚ â”œâ”€ íƒ€ì„ìŠ¤íƒ¬í”„1: 1000                                                       â”‚
â”‚ â”œâ”€ íƒ€ì„ìŠ¤íƒ¬í”„2: 1050                                                       â”‚
â”‚ â”œâ”€ íƒ€ì„ìŠ¤íƒí”„3: 1100                                                       â”‚
â”‚ â””â”€ ...                                                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5ï¸âƒ£ ë©”íŠ¸ë¦­ ì¿¼ë¦¬ (Querying)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Grafanaê°€ PromQL ì¿¼ë¦¬ë¡œ ë©”íŠ¸ë¦­ ì¡°íšŒ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚ Grafana ì¿¼ë¦¬ ê³¼ì •:                                                      â”‚
â”‚ 1. ëŒ€ì‹œë³´ë“œì˜ íŒ¨ë„ ì„¤ì •ì—ì„œ PromQL ì¿¼ë¦¬ ì •ì˜                             â”‚
â”‚ 2. ì£¼ê¸°ì ìœ¼ë¡œ(ê¸°ë³¸ 5ë¶„) ë˜ëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ Prometheusì— ì¿¼ë¦¬                â”‚
â”‚ 3. Prometheusê°€ TSDBì—ì„œ ë°ì´í„° ê²€ìƒ‰ ë° ê³„ì‚°                            â”‚
â”‚ 4. ê²°ê³¼ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜                                             â”‚
â”‚ 5. Grafanaê°€ ì°¨íŠ¸/ê²Œì´ì§€ë¡œ ì‹œê°í™”                                        â”‚
â”‚                                                                         â”‚
â”‚ ì˜ˆì‹œ PromQL ì¿¼ë¦¬:                                                       â”‚
â”‚                                                                         â”‚
â”‚ CPU ì‚¬ìš©ë¥  ê³„ì‚°:                                                        â”‚
â”‚ 100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}   â”‚
â”‚        [5m])) * 100)                                                   â”‚
â”‚                                                                         â”‚
â”‚ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ :                                                          â”‚
â”‚ (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))   â”‚
â”‚ * 100                                                                   â”‚
â”‚                                                                         â”‚
â”‚ HTTP ìš”ì²­ ì†ë„ (5ë¶„ í‰ê· ):                                              â”‚
â”‚ rate(http_requests_total[5m])                                          â”‚
â”‚                                                                         â”‚
â”‚ HTTP ì‘ë‹µ ì‹œê°„ (95 ë°±ë¶„ìœ„):                                             â”‚
â”‚ histogram_quantile(0.95, http_request_duration_seconds_bucket)        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6ï¸âƒ£ ì‹œê°í™” (Visualization)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Grafanaì—ì„œ ëŒ€ì‹œë³´ë“œì™€ ë¡œê·¸ë¡œ ì‹œê°í™”                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚ ëŒ€ì‹œë³´ë“œ êµ¬ì„± ìš”ì†Œ:                                                      â”‚
â”‚ â€¢ ê²Œì´ì§€: CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì‚¬ìš©ë¥  (%)                                 â”‚
â”‚ â€¢ ì‹œê³„ì—´ ì°¨íŠ¸: ì‹œê°„ì— ë”°ë¥¸ ë©”íŠ¸ë¦­ ë³€í™”                                    â”‚
â”‚ â€¢ í…Œì´ë¸”: ìƒì„¸ ë©”íŠ¸ë¦­ ì •ë³´                                              â”‚
â”‚ â€¢ íˆíŠ¸ë§µ: ì‘ë‹µ ì‹œê°„ ë¶„í¬                                                â”‚
â”‚ â€¢ í†µê³„: ìµœëŒ€, ìµœì†Œ, í‰ê· ê°’                                              â”‚
â”‚                                                                         â”‚
â”‚ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸:                                                        â”‚
â”‚ â€¢ ê¸°ë³¸ ìƒˆë¡œê³ ì¹¨: 30ì´ˆ                                                   â”‚
â”‚ â€¢ ìˆ˜ë™ ì„¤ì • ê°€ëŠ¥                                                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ ë° ë©”íŠ¸ë¦­

### Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜

| ë©”íŠ¸ë¦­                             | ì„¤ëª…           | ìš©ë„        |
|---------------------------------|--------------|-----------|
| `jvm_memory_used_bytes`         | JVM ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰  | ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°ì§€ |
| `jvm_gc_pause_seconds`          | GC ì¼ì‹œì •ì§€ ì‹œê°„   | ì„±ëŠ¥ ë¶„ì„     |
| `http_requests_total`           | ì´ HTTP ìš”ì²­ ìˆ˜  | íŠ¸ë˜í”½ ë¶„ì„    |
| `http_request_duration_seconds` | HTTP ì‘ë‹µ ì‹œê°„   | SLA ëª¨ë‹ˆí„°ë§  |
| `db_connection_pool_size`       | DB ì—°ê²° í’€ í¬ê¸°   | ì—°ê²° ê³ ê°ˆ ê°ì§€  |
| `process_uptime_seconds`        | ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œê°„ | ë‹¤ìš´íƒ€ì„ ê°ì§€   |

### PostgreSQL ë°ì´í„°ë² ì´ìŠ¤

| ë©”íŠ¸ë¦­                                    | ì„¤ëª…        | ìš©ë„        |
|----------------------------------------|-----------|-----------|
| `pg_stat_statements_sum_exec_time`     | ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„  | ëŠë¦° ì¿¼ë¦¬ ê°ì§€  |
| `pg_stat_statements_sum_rows_returned` | ë°˜í™˜ëœ í–‰ ìˆ˜   | ì¿¼ë¦¬ íš¨ìœ¨ì„±    |
| `pg_connections`                       | í™œì„± ì—°ê²° ìˆ˜   | ì—°ê²° í’€ ëª¨ë‹ˆí„°ë§ |
| `pg_cache_hit_ratio`                   | ìºì‹œ íˆíŠ¸ìœ¨    | ì¿¼ë¦¬ ì„±ëŠ¥     |
| `pg_replication_lag`                   | ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì§€ì—° | ë°ì´í„° ë™ê¸°í™”   |

### Redis ìºì‹œ

| ë©”íŠ¸ë¦­                              | ì„¤ëª…        | ìš©ë„        |
|----------------------------------|-----------|-----------|
| `redis_memory_used_bytes`        | ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰   | ë©”ëª¨ë¦¬ ê³ ê°ˆ ê°ì§€ |
| `redis_commands_processed_total` | ì´ ëª…ë ¹ ì‹¤í–‰ ìˆ˜ | ìºì‹œ ì‚¬ìš©ë¥     |
| `redis_keyspace_hits_total`      | ìºì‹œ íˆíŠ¸ ìˆ˜   | ìºì‹œ íš¨ìœ¨ì„±    |
| `redis_keyspace_misses_total`    | ìºì‹œ ë¯¸ìŠ¤ ìˆ˜   | ìºì‹œ íš¨ìœ¨ì„±    |
| `redis_expired_keys_total`       | ë§Œë£Œëœ í‚¤ ìˆ˜   | TTL ëª¨ë‹ˆí„°ë§  |

### Nginx ì›¹ ì„œë²„

| ë©”íŠ¸ë¦­                         | ì„¤ëª…       | ìš©ë„       |
|-----------------------------|----------|----------|
| `nginx_requests_total`      | ì´ ìš”ì²­ ìˆ˜   | íŠ¸ë˜í”½ ë¶„ì„   |
| `nginx_connections_active`  | í™œì„± ì—°ê²° ìˆ˜  | ë™ì‹œ ì‚¬ìš©ì ìˆ˜ |
| `nginx_connections_handled` | ì²˜ë¦¬ëœ ì—°ê²° ìˆ˜ | ì—°ê²° ì²˜ë¦¬ëŸ‰   |
| `nginx_connections_accepts` | ìˆ˜ë½ëœ ì—°ê²° ìˆ˜ | ì„±ëŠ¥ ì¶”ì     |

### ì„œë²„ ë¦¬ì†ŒìŠ¤ (Node Exporter)

| ë©”íŠ¸ë¦­                                | ì„¤ëª…         | ìš©ë„          |
|------------------------------------|------------|-------------|
| `node_cpu_seconds_total`           | CPU ì‚¬ìš© ì‹œê°„  | CPU ì‚¬ìš©ë¥  ê³„ì‚°  |
| `node_memory_MemAvailable_bytes`   | ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ | ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ê³„ì‚°  |
| `node_disk_io_time_seconds_total`  | ë””ìŠ¤í¬ I/O ì‹œê°„ | ë””ìŠ¤í¬ ë¶€í•˜ ëª¨ë‹ˆí„°ë§ |
| `node_network_receive_bytes_total` | ìˆ˜ì‹ í•œ ë°”ì´íŠ¸    | ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½    |

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1. Docker Composeë¡œ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì‹¤í–‰

```bash
# ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ ì‹œì‘ (Loki, Promtail, Prometheus, Grafana, Exporters)
docker-compose -f docker-compose.dev.yml up -d loki promtail prometheus grafana postgres-exporter redis-exporter nginx-exporter node-exporter cadvisor

# ìƒíƒœ í™•ì¸
docker-compose -f docker-compose.dev.yml ps

# ë¡œê·¸ í™•ì¸ (ë¬¸ì œ ë°œìƒ ì‹œ)
docker-compose -f docker-compose.dev.yml logs loki
docker-compose -f docker-compose.dev.yml logs promtail
```

### 2. Prometheus ì ‘ì†

```
http://localhost:9090
```

- **Targets**: ëª¨ë“  Exporter ìƒíƒœ í™•ì¸ (`Status` â†’ `Targets`)
- **Graph**: PromQL ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
- **Alerts**: ì•ŒëŒ ê·œì¹™ ì¡°íšŒ (ì„¤ì •ëœ ê²½ìš°)

### 3. Loki ì ‘ì† (ë¡œê·¸ í™•ì¸)

```
http://localhost:3100
```

Loki UIì—ì„œ ì§ì ‘ ë¡œê·¸ ê²€ìƒ‰ ê°€ëŠ¥

### 4. Grafana ì ‘ì†

```
http://localhost:3030
```

- **ê¸°ë³¸ ë¡œê·¸ì¸**: admin / admin
- **ë°ì´í„°ì†ŒìŠ¤**: Prometheus, Loki ìë™ ë“±ë¡ë¨ (`Connections` â†’ `Data sources`)
- **ëŒ€ì‹œë³´ë“œ**: System Overview ëŒ€ì‹œë³´ë“œ ìë™ ìƒì„±ë¨

---

## ğŸ“ Lokiì—ì„œ ë¡œê·¸ ê²€ìƒ‰í•˜ê¸°

### Grafanaì—ì„œ ë¡œê·¸ ê²€ìƒ‰

1. ì¢Œì¸¡ ë©”ë‰´ â†’ **Explore**
2. **Data source**: Loki ì„ íƒ
3. **Label filters** ë˜ëŠ” **LogQL ì¿¼ë¦¬** ì…ë ¥

### ìì£¼ ì‚¬ìš©í•˜ëŠ” LogQL ì¿¼ë¦¬

```logql
# ëª¨ë“  ë¡œê·¸ ì¡°íšŒ
{}

# ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë¡œê·¸
{application="groom-shopping"}

# íŠ¹ì • í™˜ê²½ì˜ ë¡œê·¸
{environment="dev"}

# ERROR ë ˆë²¨ ë¡œê·¸ë§Œ ì¡°íšŒ
{level="ERROR"}

# íŠ¹ì • ì„œë¹„ìŠ¤ì˜ ì—ëŸ¬ë§Œ ì¡°íšŒ
{application="groom-shopping"} | json | level="ERROR"

# ì‘ë‹µ ì‹œê°„ì´ 1ì´ˆ ì´ìƒì¸ ìš”ì²­ ë¡œê·¸
{application="groom-shopping"} | json | duration_ms > 1000

# ê²°ì œ ê´€ë ¨ ë¡œê·¸ ê²€ìƒ‰
{application="groom-shopping"} |= "payment"

# íŠ¹ì • ì‚¬ìš©ìì˜ í™œë™ ë¡œê·¸
{application="groom-shopping"} |= "userId=12345"
```

---

## ğŸ“Š ì£¼ìš” ëŒ€ì‹œë³´ë“œ

### System Overview

- **CPU ì‚¬ìš©ë¥ **: ì‹¤ì‹œê°„ ê²Œì´ì§€
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ **: ì‹¤ì‹œê°„ ê²Œì´ì§€
- **HTTP ìš”ì²­ ì†ë„**: ì‹œê°„ë³„ ê·¸ë˜í”„
- **ì‘ë‹µ ì‹œê°„**: p95, p99 ë°±ë¶„ìœ„

---

## ğŸ”§ ì„¤ì • íŒŒì¼

### Prometheus ì„¤ì •

**íŒŒì¼**: `monitoring/promethous/promethous.yml`

```yaml
global:
  scrape_interval: 15s      # ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì£¼ê¸°
  evaluation_interval: 15s  # ì•ŒëŒ í‰ê°€ ì£¼ê¸°

scrape_configs:
  - job_name: 'spring-boot'
    metrics_path: '/api/actuator/prometheus'
    scrape_interval: 10s    # Spring BootëŠ” ë” ìì£¼ ìˆ˜ì§‘
    static_configs:
      - targets: [ 'host.docker.internal:8080' ]
  # ê¸°íƒ€ exporters...
```

### Promtail ì„¤ì • (ë¡œê·¸ ìˆ˜ì§‘)

**íŒŒì¼**: `monitoring/promtail/config.yml`

```yaml
server:
  http_listen_port: 9080

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  # Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
  - job_name: spring-boot
    static_configs:
      - targets:
          - localhost
        labels:
          job: spring-boot
          application: groom-shopping
          environment: dev
          __path__: /var/log/app/application*.log
```

**ì—­í• **:

- `logs/application.log` íŒŒì¼ ê°ì‹œ
- ë³€ê²½ì‚¬í•­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ Lokiì— ì „ì†¡
- ë¼ë²¨ì„ ê¸°ë°˜ìœ¼ë¡œ ë¡œê·¸ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜

### Loki ì„¤ì •

**íŒŒì¼**: `monitoring/loki/loki-config.yml`

```yaml
auth_enabled: false

ingester:
  chunk_idle_period: 3m
  chunk_retain_period: 1m
  max_chunk_age: 1h

limits_config:
  ingestion_rate_mb: 8
  ingestion_burst_size_mb: 16

schema_config:
  configs:
    - from: 2023-01-01
      store: boltdb-shipper
      object_store: filesystem
      schema: v11

storage_config:
  filesystem:
    directory: /loki/chunks
```

### Spring Boot Logback ì„¤ì •

**íŒŒì¼**: `backend/src/main/resources/logback-spring.xml`

**ë¡œê·¸ ì¶œë ¥ ë°©ì‹**:

- **ì½˜ì†” ë¡œê·¸**: ê°œë°œ ì¤‘ ì‹¤ì‹œê°„ í™•ì¸ (IntelliJ ì½˜ì†”)
- **íŒŒì¼ ë¡œê·¸**: `logs/application.log` ì €ì¥ (Rolling ë°©ì‹)
- **Promtail ìˆ˜ì§‘**: íŒŒì¼ ë¡œê·¸ë¥¼ ìë™ìœ¼ë¡œ ê°ì‹œí•˜ì—¬ Lokië¡œ ì „ì†¡

**íë¦„**:

```
Spring Boot â†’ logback-spring.xml â†’ logs/application.log
                                          â†“
                                    Promtail (ê°ì‹œ)
                                          â†“
                                    Loki (ì €ì¥)
                                          â†“
                                  Grafana (ê²€ìƒ‰/ë¶„ì„)
```

### Grafana Provisioning

**ë°ì´í„°ì†ŒìŠ¤**:

- `grafana/provisioning/datasources/prometheus.yml` - Prometheus (ë©”íŠ¸ë¦­)
- `grafana/provisioning/datasources/loki.yml` - Loki (ë¡œê·¸)

ìë™ ë“±ë¡ë¨

**ëŒ€ì‹œë³´ë“œ**: `grafana/provisioning/dashboards/system-overview.json`

- ì‹œìŠ¤í…œ ê°œìš” ëŒ€ì‹œë³´ë“œ ìë™ ìƒì„±

---

## ğŸ“ˆ ì„±ëŠ¥ ê¶Œì¥ê°’

| ë©”íŠ¸ë¦­           | ê²½ê³       | ì‹¬ê°       |
|---------------|---------|----------|
| CPU ì‚¬ìš©ë¥        | > 70%   | > 90%    |
| ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥        | > 80%   | > 95%    |
| HTTP p99 ì‘ë‹µì‹œê°„ | > 500ms | > 1000ms |
| DB ìºì‹œ íˆíŠ¸ìœ¨     | < 90%   | < 70%    |
| Redis ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  | > 80%   | > 95%    |

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Prometheusê°€ íƒ€ê²Ÿì— ì—°ê²° ëª»í•¨

1. **Spring Boot íƒ€ê²Ÿ ì˜¤ë¥˜**
   ```bash
   # IntelliJì—ì„œ Spring Bootê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
   http://localhost:8080/api/actuator/prometheus ì§ì ‘ ì ‘ì† í…ŒìŠ¤íŠ¸
   ```

2. **Exporter íƒ€ê²Ÿ ì˜¤ë¥˜**
   ```bash
   # Docker ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
   docker-compose logs postgres-exporter
   docker-compose logs redis-exporter
   ```

3. **ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ**
   ```bash
   # Docker ë„¤íŠ¸ì›Œí¬ í™•ì¸
   docker network ls
   docker network inspect monitoring
   ```

### Grafanaì—ì„œ "No data" í‘œì‹œ

1. Prometheus ë°ì´í„°ì†ŒìŠ¤ í™•ì¸
    - `Connections` â†’ `Data sources` â†’ `Prometheus` â†’ `Test datasource`

2. PromQL ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
    - Prometheus UIì—ì„œ ì¿¼ë¦¬ ì‹¤í–‰ í›„ ë°ì´í„° ìˆ˜ì‹  í™•ì¸

3. ë©”íŠ¸ë¦­ ì¡´ì¬ í™•ì¸
    - Prometheus UI â†’ `Graph` â†’ ë©”íŠ¸ë¦­ ê²€ìƒ‰

### Lokiì— ë¡œê·¸ê°€ ì•ˆ ë‚˜íƒ€ë‚¨

1. **Loki ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸**
   ```bash
   docker-compose logs loki
   ```

2. **Spring Boot ë¡œê·¸ ì „ì†¡ í™•ì¸**
   ```bash
   # logback-spring.xmlì´ í™œì„±í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
   # ê°œë°œ í™˜ê²½ì—ì„œë§Œ Loki ë¡œê·¸ ì „ì†¡ì´ í™œì„±í™”ë¨
   # IntelliJ ì½˜ì†”ì—ì„œ "LOKI" ê´€ë ¨ ë¡œê·¸ í™•ì¸
   ```

3. **Loki ë°ì´í„°ì†ŒìŠ¤ ì—°ê²° í™•ì¸**
    - Grafana â†’ `Connections` â†’ `Data sources` â†’ `Loki` â†’ `Test datasource`

4. **ë¡œê·¸ ë¼ë²¨ í™•ì¸**
    - Loki UI (`http://localhost:3100`) â†’ ë¼ë²¨ ì„ íƒ ê°€ëŠ¥í•œì§€ í™•ì¸

### Grafanaì—ì„œ Loki ë°ì´í„°ì†ŒìŠ¤ ì—°ê²° ì˜¤ë¥˜

**ì˜¤ë¥˜**: `http: no Host in request URL` ë˜ëŠ” ì—°ê²° ì‹¤íŒ¨

**í•´ê²°ì±…**:

- Loki URLì€ **`http://loki:3100`** (localhost ì ˆëŒ€ ê¸ˆì§€!)
- Docker ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì„œë¹„ìŠ¤ëª…ìœ¼ë¡œ ì ‘ê·¼

---

## ğŸ“š ì°¸ê³ ìë£Œ

- [Prometheus ê³µì‹ ë¬¸ì„œ](https://prometheus.io/docs/)
- [Grafana ê³µì‹ ë¬¸ì„œ](https://grafana.com/docs/)
- [Loki ê³µì‹ ë¬¸ì„œ](https://grafana.com/docs/loki/)
- [LogQL ì¿¼ë¦¬ ì–¸ì–´](https://grafana.com/docs/loki/latest/logql/)
- [PromQL ì¿¼ë¦¬ ì–¸ì–´](https://prometheus.io/docs/prometheus/latest/querying/basics/)
- [Spring Boot Actuator](https://spring.io/guides/gs/actuator-service/)

---

## ğŸ’¡ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ì´ë“œ

### ìƒˆë¡œìš´ ë©”íŠ¸ë¦­ ì¶”ê°€ (Spring Boot)

Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ì¶”ê°€:

```java

@Component
public class CustomMetrics {
    private final MeterRegistry meterRegistry;

    public CustomMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
    }

    public void recordOrderCreated() {
        meterRegistry.counter("orders_created_total", "status", "success").increment();
    }
}
```

### ì•ŒëŒ ê·œì¹™ ì¶”ê°€ (Prometheus)

`monitoring/promethous/rules.yml` ìƒì„± í›„ prometheus.ymlì— ì¶”ê°€:

```yaml
rule_files:
  - '/etc/prometheus/rules.yml'

groups:
  - name: alerts
    interval: 30s
    rules:
      - alert: HighCPUUsage
        expr: node_cpu_usage > 90
        for: 5m
        annotations:
          summary: "High CPU usage detected"
```

### ì»¤ìŠ¤í…€ ë¡œê·¸ ë¼ë²¨ ì¶”ê°€ (Loki)

logback-spring.xmlì˜ Loki ì„¤ì •ì— ì»¤ìŠ¤í…€ ë¼ë²¨ ì¶”ê°€:

```xml

<appender name="LOKI" class="com.grafana.loki.client.logback.LokiAppender">
    <url>http://loki:3100/loki/api/v1/push</url>
    <label>
        <application>groom-shopping</application>
        <environment>dev</environment>
        <service>order-service</service>
        <team>backend</team>
    </label>
</appender>
```

Grafanaì—ì„œ LogQLë¡œ ì´ ë¼ë²¨ë“¤ë¡œ í•„í„°ë§ ê°€ëŠ¥:

```logql
{application="groom-shopping", service="order-service"} | json
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-11-13
